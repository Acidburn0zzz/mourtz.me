<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Alex &#183; Mourtziapis</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="../../favicon.jpg" />
    <meta name="keywords" content="Reverse Engineering, Assembly, GDB, Linux" />
    <meta name="description" content="Basic Reverse Engineering using GDB and the Linux" />

    <!-- Bootstrap Core CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../../css/simple-sidebar.css" rel="stylesheet">

    <!--  Font Awesome  -->
    <link href="../../css/font-awesome.min.css" rel="stylesheet">

    <!--  CodeMirror  -->
    <link href="../../lib/CodeMirror/lib/codemirror.css" rel="stylesheet">

    <!--  CodeMirror Themes  -->
    <link href="../../lib/CodeMirror/theme/monokai.css" rel="stylesheet">
    <link href="../../lib/CodeMirror/theme/base16-dark.css" rel="stylesheet">
    <link href="../../lib/CodeMirror/theme/3024-night.css" rel="stylesheet">
    <link href="../../lib/CodeMirror/theme/zenburn.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<style>
    #page-content-wrapper ul li {
        display: table-cell;
        vertical-align: top;
    }
</style>

<body>

    <div id="wrapper">

        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">

                <li class="sidebar-brand">
                    <a href="../../">
                        <img src="../../favicon.jpg" class="img-rounded" width="40px"> Alex Mourtziapis
                    </a>
                </li>
                <div id="nav-list">
                    <li>
                        <a href="../me/">About me</a>
                    </li>
                    <li>
                        <a href="#">Collaborations</a>
                    </li>
                    <li>
                        <a href="../works/">Works of mine</a>
                    </li>
                    <li>
                        <a href="../eyecandy/">Eye candy</a>
                    </li>
                </div>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <h2>Simple waving flag effect in GLSL</h2>
            Just a simple waving flag effect, nothing too fancy like tearable cloth, verlet physics etc.
            <ul>
                <li>
                    <div id="No0-wrapper"></div>
                </li>
                <li>
                    fx <input id="windX" type="range" min="0.0" max="0.5" value="0.15" step="0.01">
                    fy <input id="windY" type="range" min="0.0" max="1.0" value="0.65" step="0.01">
                    fz <input id="windZ" type="range" min="0.0" max="1.0" value="0.79" step="0.01">
                    rotationY <input id="rotY" type="range" min="-0.5" max="0.5" value="0.0" step="0.01" onchange="setRotationY(this);">
                </li>
            </ul>

            <br>
            <br>
            <br>
            <br>
            <a href="#menu-toggle" class="btn btn-default" id="menu-toggle"> <i class="fa fa-arrow-circle-o-left"> Close Menu</i></a>
        </div>
        <!-- /#page-content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../../lib/jquery.min.js"></script>

    <!-- jQuery Easing -->
    <script src="../../lib/jquery.easing.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../../lib/bootstrap.min.js"></script>

    <!--  marked js  -->
    <script src="../../lib/marked.min.js"></script>

    <!--  CodeMirror  -->
    <script src="../../lib/CodeMirror/lib/codemirror.js"></script>

    <!--  CodeMirror lib/CodeMirror/mode/s  -->
    <script src="../../lib/CodeMirror/mode/clike/clike.js"></script>
    <script src="../../js/glsl.js"></script>
    <script src="../../lib/CodeMirror/mode/shell/shell.js"></script>

    <!--  CodeMirror Addons -->
    <script src="../../lib/CodeMirror/addon/runmode/runmode.js"></script>

    <!-- index -->
    <script src="../../js/index.js"></script>

    <script>
        var w = Math.floor(document.getElementById('page-content-wrapper').offsetWidth / 1.5);
        $("#page-content-wrapper input").css("width", w / 3);

        // Provides requestAnimationFrame in a cross browser way.
        window.requestAnimFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (callback, element) {
                    return window.setTimeout(callback, 1000 / 60);
                };
        })();
    </script>

    <script>
        "uses strict";

        var window_width = w,
            window_height = w * 0.5625;
        var aspect_ratio = window_width / window_height;
        var fov = 45.0;
        var zfar = 1024.0,
            znear = 0.1;

        var canvas = document.createElement('canvas');
        canvas.width = window_width;
        canvas.height = window_height;
        document.getElementById('No0-wrapper').appendChild(canvas);

        var gl = undefined;
        try {
            gl = canvas.getContext('webgl');

            var EXT = gl.getExtension("OES_element_index_uint") ||
                gl.getExtension("MOZ_OES_element_index_uint") ||
                gl.getExtension("WEBKIT_OES_element_index_uint");

            gl.clearColor(0.0, 0.0, 0.0, 0.0);
            gl.enable(gl.DEPTH_TEST);
            gl.depthFunc(gl.LESS);
            gl.enable(gl.CULL_FACE);
            //    gl.clearDepth(1.0);
        } catch (e) {
            console.error("It does not appear your computer can support WebGL.");
        }

        function CreateViewMatrix(position, direction, up) {
            let f = direction;
            let len = Math.sqrt(f[0] * f[0] + f[1] * f[1] + f[2] * f[2]);
            f = [f[0] / len, f[1] / len, f[2] / len];

            let s = [
                up[1] * f[2] - up[2] * f[1],
                up[2] * f[0] - up[0] * f[2],
                up[0] * f[1] - up[1] * f[0]
            ];

            len = Math.sqrt(s[0] * s[0] + s[1] * s[1] + s[2] * s[2]);

            let s_norm = [
                s[0] / len,
                s[1] / len,
                s[2] / len
            ];

            let u = [
                f[1] * s_norm[2] - f[2] * s_norm[1],
                f[2] * s_norm[0] - f[0] * s_norm[2],
                f[0] * s_norm[1] - f[1] * s_norm[0]
            ];

            let p = [
                -position[0] * s_norm[0] - position[1] * s_norm[1] - position[2] * s_norm[2],
                -position[0] * u[0] - position[1] * u[1] - position[2] * u[2],
                -position[0] * f[0] - position[1] * f[1] - position[2] * f[2]
            ];

            return [
                s_norm[0], u[0], f[0], 0.0,
                s_norm[1], u[1], f[1], 0.0,
                s_norm[2], u[2], f[2], 0.0,
                p[0], p[1], p[2], 1.0
            ];
        }

        function CreatePerspectiveMatrix() {
            let f = Math.tan(Math.PI * 0.5 - 0.5 * fov);
            let range = 1.0 / (znear - zfar);
            return [
                f / aspect_ratio, 0.0, 0.0, 0.0,
                0.0, f, 0.0, 0.0,
                0.0, 0.0, (znear + zfar) * range, -1.0,
                0.0, 0.0, znear * zfar * range * 2, 0.0
            ];
        }

        var viewMatrix = CreateViewMatrix([0.5, 0.0, 0.0], [0.0, 0.0, 1.0], [0.0, 1.0, 0.0]);
        var perspectiveMatrix = CreatePerspectiveMatrix();

        var vertexShader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vertexShader, fetchHTTP("./vert.glsl"));
        gl.compileShader(vertexShader);

        var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fragmentShader, fetchHTTP("./frag.glsl"));
        gl.compileShader(fragmentShader);

        var program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            var info = gl.getProgramInfoLog(program);
            throw "Could not compile WebGL program. \n\n" + info;
        }

        var perspectiveMatrixID = gl.getUniformLocation(program, "u_perspective");
        var modelMatrixID = gl.getUniformLocation(program, "u_model");
        var viewMatrixID = gl.getUniformLocation(program, "u_view");
        var timeID = gl.getUniformLocation(program, "u_time");
        var resolutionID = gl.getUniformLocation(program, "u_resolution");
        var windID = gl.getUniformLocation(program, "u_wind");

        var a_PostionID = gl.getAttribLocation(program, "a_position");
        var a_NormalID = gl.getAttribLocation(program, "a_normal");
        var a_UvID = gl.getAttribLocation(program, "a_uv");

        var model = JSON.parse(fetchHTTP('./plane.json'));
        var vertices = new Float32Array(model.vertexPositions);
        var uvs = new Float32Array(model.vertexTextureCoords);
        var normals = new Float32Array(model.vertexNormals);
        var indices = new Uint32Array(model.indices);

        var vertexbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vertexbuffer);
        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

        var uvbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, uvbuffer);
        gl.bufferData(gl.ARRAY_BUFFER, uvs, gl.STATIC_DRAW);

        var normalbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, normalbuffer);
        gl.bufferData(gl.ARRAY_BUFFER, normals, gl.STATIC_DRAW);

        var indicesbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indicesbuffer);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);

        // 1st attribute buffer : vertices
        gl.enableVertexAttribArray(a_PostionID);
        gl.bindBuffer(gl.ARRAY_BUFFER, vertexbuffer);
        gl.vertexAttribPointer(a_PostionID, 3, gl.FLOAT, false, 0, 0);
        // 2nd attribute buffer : normals
        gl.enableVertexAttribArray(a_NormalID);
        gl.bindBuffer(gl.ARRAY_BUFFER, normalbuffer);
        gl.vertexAttribPointer(a_NormalID, 3, gl.FLOAT, false, 0, 0);
        // 3nd attribute buffer : uvs
        gl.enableVertexAttribArray(a_UvID);
        gl.bindBuffer(gl.ARRAY_BUFFER, uvbuffer);
        gl.vertexAttribPointer(a_UvID, 2, gl.FLOAT, false, 0, 0);

        gl.useProgram(program);
        var loadTime = Date.now();
        var lastTime = loadTime;
        var nbFrames = 0;

        var Texture = gl.createTexture();
        var Image = new Image();
        Image.src = "./img1.jpg";

        Image.onload = function () {
            gl.bindTexture(gl.TEXTURE_2D, Texture);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, Image);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            gl.bindTexture(gl.TEXTURE_2D, null);

            gl.uniform1i(gl.getUniformLocation(program, "u_iChannel0"), 0);
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, Texture);
        }

        /// Wind Uniform
        var wind = [0.25, 0.65, 0.79];
        gl.uniform3fv(windID, wind);

        $("#windX").on('change', function(){
            wind[0] = this.value;
            gl.uniform3fv(windID, wind);
        });
        $("#windY").on('change', function(){
            wind[1] = this.value;
            gl.uniform3fv(windID, wind);
        });
        $("#windZ").on('change', function(){
            wind[2] = this.value;
            gl.uniform3fv(windID, wind);
        });
        /// Resolution Uniform
        gl.uniform2f(resolutionID, canvas.width, canvas.height);
        // Perspective Matrix Uniform
        gl.uniformMatrix4fv(perspectiveMatrixID, false, perspectiveMatrix);
        // View Matrix Uniform
        gl.uniformMatrix4fv(viewMatrixID, false, viewMatrix);
        // Model Matrix Uniform
        var rotationY = 0.0;
        function setRotationY(v){
            rotationY = v.value;
            gl.uniformMatrix4fv(modelMatrixID, false, [
                0.5, 0.0, rotationY, 0.0,
                0.0, 0.5, 0.0, 0.0,
                -rotationY, 0.0, 0.5, 0.0,
                0.0, 0.0, -2.0, 1.0
            ]);
        }
        gl.uniformMatrix4fv(modelMatrixID, false, [
            0.5, 0.0, rotationY, 0.0,
            0.0, 0.5, 0.0, 0.0,
            -rotationY, 0.0, 0.5, 0.0,
            0.0, 0.0, -2.0, 1.0
        ]);

        function render() {

            let currentTime = Date.now();
            nbFrames++;
            if (currentTime - lastTime >= 1000.0) {
                console.log(1000.0 / nbFrames + " ms/frame");
                nbFrames = 0;
                lastTime += 1000.0;
            }

            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            // Time Uniform
            gl.uniform1f(gl.getUniformLocation(program, 'u_time'), (currentTime - loadTime) / 1000.0);

            // Draw suzanne !
            gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_INT, 0);

            //gl.flush();
            window.requestAnimFrame(render);
        }
        render();
    </script>

    <!--
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-66672624-1', 'auto');
        ga('send', 'pageview');
    </script>
-->

</body>

</html>
